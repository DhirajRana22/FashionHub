<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice - Order #{{ order.id }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none !important; }
            body { font-size: 12px; }
        }
        .invoice-header {
            border-bottom: 2px solid #007bff;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .company-info {
            text-align: right;
        }
        .invoice-details {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .table th {
            background-color: #007bff;
            color: white;
        }
        .total-section {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- Print Button -->
        <div class="no-print mb-3">
            <button onclick="window.print()" class="btn btn-primary">
                <i class="fas fa-print me-2"></i>Print Invoice
            </button>
            <button onclick="window.close()" class="btn btn-secondary ms-2">
                <i class="fas fa-times me-2"></i>Close
            </button>
        </div>

        <!-- Invoice Header -->
        <div class="invoice-header row">
            <div class="col-md-6">
                <h1 class="text-primary">{{ company_name }}</h1>
                <p class="mb-1">{{ company_address }}</p>
                <p class="mb-1">Phone: {{ company_phone }}</p>
                <p class="mb-0">Email: {{ company_email }}</p>
            </div>
            <div class="col-md-6 company-info">
                <h2 class="text-muted">INVOICE</h2>
                <p class="mb-1"><strong>Invoice #:</strong> INV-{{ order.id }}</p>
                <p class="mb-1"><strong>Order #:</strong> {{ order.id }}</p>
                <p class="mb-0"><strong>Date:</strong> {{ order.created_at|date:"F d, Y" }}</p>
            </div>
        </div>

        <!-- Customer Information -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="invoice-details">
                    <h5 class="text-primary mb-3">Bill To:</h5>
                    <p class="mb-1"><strong>{{ order.full_name }}</strong></p>
                    <p class="mb-1">{{ order.email }}</p>
                    <p class="mb-0">{{ order.phone }}</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="invoice-details">
                    <h5 class="text-primary mb-3">Ship To:</h5>
                    <p class="mb-1">{{ order.address }}</p>
                    <p class="mb-1">{{ order.city }}, {{ order.state }}</p>
                    <p class="mb-0">{{ order.postal_code }}</p>
                    {% if order.receiver_name %}
                        <hr>
                        <p class="mb-1"><strong>Receiver:</strong> {{ order.receiver_name }}</p>
                        {% if order.receiver_phone %}
                            <p class="mb-0"><strong>Phone:</strong> {{ order.receiver_phone }}</p>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Order Items -->
        <div class="table-responsive mb-4">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Category</th>
                        <th class="text-end">Unit Price</th>
                        <th class="text-center">Quantity</th>
                        <th class="text-end">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order_items %}
                    <tr>
                        <td>
                            <strong>{{ item.product.name }}</strong>
                            {% if item.product.season %}
                                <br><small class="text-muted">{{ item.product.season.name }}</small>
                            {% endif %}
                        </td>
                        <td>{{ item.product.category.name }}</td>
                        <td class="text-end">Rs.{{ item.price|floatformat:2 }}</td>
                        <td class="text-center">{{ item.quantity }}</td>
                        <td class="text-end">Rs.{{ item.get_total|floatformat:2 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Total Section -->
        <div class="row">
            <div class="col-md-6">
                <div class="invoice-details">
                    <h5 class="text-primary mb-3">Payment Information:</h5>
                    <p class="mb-1"><strong>Payment Method:</strong> {{ order.payment_method|default:"Cash on Delivery" }}</p>
                    <p class="mb-1"><strong>Payment Status:</strong> 
                        <span class="badge {% if order.payment_status == 'completed' %}bg-success{% elif order.payment_status == 'pending' %}bg-warning{% else %}bg-danger{% endif %}">
                            {{ order.get_payment_status_display|default:"Pending" }}
                        </span>
                    </p>
                    <p class="mb-0"><strong>Order Status:</strong> 
                        <span class="badge {% if order.status == 'delivered' %}bg-success{% elif order.status == 'shipped' %}bg-primary{% elif order.status == 'confirmed' %}bg-info{% elif order.status == 'pending' %}bg-warning{% else %}bg-danger{% endif %}">
                            {{ order.get_status_display }}
                        </span>
                    </p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="total-section">
                    <div class="row mb-2">
                        <div class="col-6"><strong>Subtotal:</strong></div>
                        <div class="col-6 text-end">Rs.{{ order.get_subtotal|floatformat:2 }}</div>
                    </div>
                    {% if order.shipping_cost %}
                    <div class="row mb-2">
                        <div class="col-6"><strong>Shipping:</strong></div>
                        <div class="col-6 text-end">Rs.{{ order.shipping_cost|floatformat:2 }}</div>
                    </div>
                    {% endif %}
                    {% if order.tax_amount %}
                    <div class="row mb-2">
                        <div class="col-6"><strong>Tax:</strong></div>
                        <div class="col-6 text-end">Rs.{{ order.tax_amount|floatformat:2 }}</div>
                    </div>
                    {% endif %}
                    <hr>
                    <div class="row">
                        <div class="col-6"><h5><strong>Total:</strong></h5></div>
                        <div class="col-6 text-end"><h5><strong>Rs.{{ order.total_amount|floatformat:2 }}</strong></h5></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-5 pt-4 border-top">
            <p class="text-muted mb-0">Thank you for your business!</p>
            <p class="text-muted">For any questions regarding this invoice, please contact us at {{ company_email }}</p>
        </div>
    </div>

    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js"></script>
</body>
</html>